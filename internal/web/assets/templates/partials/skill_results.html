{{if .Results}}
<div class="space-y-4">
    <!-- Results header -->
    <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">
            {{if .Query}}
                Search results for "{{.Query}}" ({{.Total}} skills)
            {{else}}
                Showing {{len .Results}} skills
            {{end}}
        </h3>
    </div>

    <!-- Results grid -->
    <div class="search-results">
        {{range .Results}}
        <div class="item-card" onclick="showSkillDetail({{.ID}})">
            <div class="item-header">
                <div class="flex-1">
                    <h4 class="item-name text-blue-600">{{.Name}}</h4>
                    <div class="item-level">{{.Type}} Skill</div>
                </div>
                <div class="item-icon text-blue-600">
                    {{skillTypeIcon .Type}}
                </div>
            </div>
            
            <div class="item-type text-gray-600 dark:text-gray-400">
                {{if .Professions}}
                    {{join ", " .Professions}}
                {{else}}
                    All Professions
                {{end}}
            </div>
            
            {{if .Description}}
            <div class="item-description">
                {{truncate .Description 100}}
            </div>
            {{end}}
            
            {{if .Facts}}
            <div class="item-stats">
                <div class="text-xs text-gray-600 dark:text-gray-400">
                    {{len .Facts}} fact{{if ne (len .Facts) 1}}s{{end}}
                </div>
            </div>
            {{end}}
        </div>
        {{end}}
    </div>

    <!-- Load more button if there are more results -->
    {{if .HasMore}}
    <div class="text-center mt-8">
        <button class="gw2-button gw2-button-secondary" 
                hx-get="/search/skills?page={{add .Page 1}}" 
                hx-target="#skills-results" 
                hx-swap="afterend"
                hx-include="form">
            Load More Skills
        </button>
    </div>
    {{end}}
</div>

<script>
function showSkillDetail(skillId) {
    fetch(`/api/skill?id=${skillId}`)
        .then(response => response.json())
        .then(skill => {
            const content = `
                <div class="space-y-4">
                    <div class="flex items-start space-x-4">
                        <div class="text-4xl">${skill.icon ? 'üñºÔ∏è' : '‚ú®'}</div>
                        <div class="flex-1">
                            <h3 class="text-xl font-bold text-blue-600">${skill.name}</h3>
                            <p class="text-gray-600">${skill.type} Skill</p>
                            ${skill.description ? `<p class="mt-2">${skill.description}</p>` : ''}
                        </div>
                        <div class="text-right">
                            ${skill.professions ? `<div class="text-sm text-gray-500">Professions: ${skill.professions.join(', ')}</div>` : ''}
                            <div class="text-sm text-gray-500">ID: ${skill.id}</div>
                        </div>
                    </div>
                    
                    ${skill.facts ? renderSkillFacts(skill.facts) : ''}
                    ${skill.traited_facts ? renderTraitedFacts(skill.traited_facts) : ''}
                    
                    <div class="flex space-x-2 pt-4 border-t">
                        <button onclick="copySkillLink(${skill.id})" class="gw2-button gw2-button-secondary">Copy Link</button>
                        <button onclick="viewOnWiki('${skill.name}')" class="gw2-button gw2-button-secondary">View on Wiki</button>
                    </div>
                </div>
            `;
            openModal(skill.name, content);
        })
        .catch(err => {
            openModal('Error', `<p class="text-red-600">Failed to load skill details: ${err.message}</p>`);
        });
}

function renderSkillFacts(facts) {
    if (!facts || facts.length === 0) return '';
    
    let html = '<div class="space-y-2"><div class="font-medium">Facts:</div>';
    facts.forEach(fact => {
        html += `<div class="text-sm bg-gray-50 dark:bg-gray-700 p-2 rounded">`;
        html += `<strong>${fact.type}:</strong> `;
        
        if (fact.text) {
            html += fact.text;
        } else if (fact.value !== undefined) {
            html += fact.value;
            if (fact.target) html += ` (${fact.target})`;
        }
        
        if (fact.description) {
            html += ` - ${fact.description}`;
        }
        
        html += '</div>';
    });
    html += '</div>';
    return html;
}

function renderTraitedFacts(traitedFacts) {
    if (!traitedFacts || traitedFacts.length === 0) return '';
    
    let html = '<div class="space-y-2"><div class="font-medium">Traited Facts:</div>';
    traitedFacts.forEach(fact => {
        html += `<div class="text-sm bg-blue-50 dark:bg-blue-900 p-2 rounded">`;
        html += `<strong>${fact.type}:</strong> `;
        
        if (fact.text) {
            html += fact.text;
        } else if (fact.value !== undefined) {
            html += fact.value;
        }
        
        if (fact.requires_trait) {
            html += ` <span class="text-blue-600">(Requires trait ${fact.requires_trait})</span>`;
        }
        
        html += '</div>';
    });
    html += '</div>';
    return html;
}

function copySkillLink(skillId) {
    const url = `${window.location.origin}/skill/${skillId}`;
    navigator.clipboard.writeText(url).then(() => {
        alert('Skill link copied to clipboard!');
    });
}
</script>

{{else}}
<div class="text-center py-12 text-gray-500 dark:text-gray-400">
    {{if .Query}}
        <div class="text-6xl mb-4">üîç</div>
        <h3 class="text-lg font-medium mb-2">No skills found</h3>
        <p>Try adjusting your search filters or search terms.</p>
    {{else}}
        <div class="text-6xl mb-4">‚ú®</div>
        <h3 class="text-lg font-medium mb-2">Search for skills</h3>
        <p>Use the search form above to find Guild Wars 2 skills.</p>
    {{end}}
</div>
{{end}}